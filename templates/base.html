<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>{% block title %}Family Finance{% endblock %}</title>

  <!-- Critical for mobile -->
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="theme-color" content="#4f46e5">

  <!-- Tailwind (replace with your pipeline if you self-build) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Icons (Lucide) -->
  <script src="https://unpkg.com/lucide@latest"></script>

  {% block head %}{% endblock %}
  <style>
    /* Improve tap targets on mobile */
    input, select, textarea, button { font-size: 16px; min-height: 44px; }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">
  <!-- Header / Navbar -->
  <header class="sticky top-0 z-40 bg-white/90 backdrop-blur border-b">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
      <a href="{{ url_for('home') }}" class="text-lg font-bold tracking-tight">Family Finance</a>

      <!-- Mobile menu button -->
      <button id="navToggle" class="sm:hidden inline-flex items-center p-2 rounded-md border" aria-label="Open menu" aria-expanded="false" aria-controls="mobileNav">
        <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none"><path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2"/></svg>
      </button>

      <!-- Desktop navigation -->
      <nav class="hidden sm:flex items-center gap-6">
        <a href="{{ url_for('home') }}"
           class="hover:text-indigo-600 {{ 'text-indigo-600 font-semibold' if request.endpoint=='home' else '' }}">Home</a>
        <a href="{{ url_for('assets') }}"
           class="hover:text-indigo-600 {{ 'text-indigo-600 font-semibold' if request.endpoint=='assets' else '' }}">Assets</a>
        <a href="{{ url_for('expenses') }}"
           class="hover:text-indigo-600 {{ 'text-indigo-600 font-semibold' if request.endpoint=='expenses' else '' }}">Expenses</a>
        <a href="{{ url_for('profile') }}"
           class="hover:text-indigo-600 {{ 'text-indigo-600 font-semibold' if request.endpoint=='profile' else '' }}">Profile</a>
      </nav>
    </div>

    <!-- Mobile dropdown -->
    <nav id="mobileNav" class="sm:hidden hidden px-4 pb-3 space-y-2 border-t">
      <a href="{{ url_for('home') }}" class="block py-2">Home</a>
      <a href="{{ url_for('assets') }}" class="block py-2">Assets</a>
      <a href="{{ url_for('expenses') }}" class="block py-2">Expenses</a>
      <a href="{{ url_for('profile') }}" class="block py-2">Profile</a>
      <form action="{{ url_for('logout') }}" method="get" class="pt-1">
        <button class="w-full py-2 rounded bg-gray-100 hover:bg-gray-200">Logout</button>
      </form>
    </nav>
  </header>

  <!-- Flash alerts -->
  <div class="max-w-7xl mx-auto px-4 mt-4 space-y-2">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="rounded-lg px-4 py-3 text-sm
            {% if category=='success' %} bg-green-50 text-green-700 border border-green-200
            {% elif category=='error' %} bg-red-50 text-red-700 border border-red-200
            {% elif category=='warning' %} bg-yellow-50 text-yellow-800 border border-yellow-200
            {% else %} bg-blue-50 text-blue-800 border border-blue-200 {% endif %}">
            {{ message }}
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}
  </div>

  <!-- Page header (optional blocks) -->
  <div class="max-w-7xl mx-auto px-4 mt-4">
    {% block header_title %}{% endblock %}
    {% block header_subtitle %}{% endblock %}
  </div>

  <!-- Main content wrapper -->
  <main class="px-4 sm:px-6 py-4 max-w-7xl mx-auto">
    {% block content %}{% endblock %}
  </main>

  <!-- Footer -->
  <footer class="mt-10 py-8 text-center text-xs text-gray-500">
    Â© {{  now().year if false else '' }} Family Finance
  </footer>

  {% block scripts %}{% endblock %}
  <script>
    // Mobile nav toggler
    document.addEventListener('DOMContentLoaded', () => {
      const btn = document.getElementById('navToggle');
      const panel = document.getElementById('mobileNav');
      if (btn && panel) btn.onclick = () => {
        const isOpen = !panel.classList.toggle('hidden');
        btn.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
      };
      // Render Lucide icons if present
      if (window.lucide) { try { lucide.createIcons(); } catch(e){} }
    });
  </script>
</body>
</html>
